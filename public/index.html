<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Rbit Terminal</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=JetBrains+Mono:wght@400;700&display=swap"
        rel="stylesheet">

    <style>
        :root {
            --bg-color: #0c0c0c;
            --card-bg: #151515;
            --sidebar-bg: #111;
            --text-main: #e0e0e0;
            --accent: #F7931A;
            --green: #00E676;
            --red: #FF3D00;
            --border: #333;
            --safe-top: env(safe-area-inset-top);
            --safe-bottom: env(safe-area-inset-bottom);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, sans-serif;
            background: var(--bg-color);
            color: var(--text-main);
            height: 100vh;
            display: flex;
            flex-direction: column;
            padding-top: var(--safe-top);
            padding-bottom: var(--safe-bottom);
        }

        /* HEADER */
        .header {
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 15px;
            border-bottom: 1px solid var(--border);
            background: #111;
            z-index: 100;
            flex-shrink: 0;
        }

        .logo {
            font-weight: 700;
            font-size: 1.1rem;
            color: #fff;
            letter-spacing: -0.5px;
        }

        .logo span {
            color: var(--accent);
        }

        .menu-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #aaa;
            padding: 5px;
            cursor: pointer;
            display: none;
        }

        /* LAYOUT */
        .layout {
            display: flex;
            flex: 1;
            overflow: hidden;
            position: relative;
        }

        /* SIDEBAR */
        .sidebar {
            width: 260px;
            background: var(--sidebar-bg);
            border-right: 1px solid var(--border);
            overflow-y: auto;
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
        }

        .sb-section {
            padding: 15px;
            border-bottom: 1px solid #222;
        }

        .sb-title {
            font-size: 0.75rem;
            color: #666;
            font-weight: 700;
            text-transform: uppercase;
            margin-bottom: 10px;
        }

        .sb-btn {
            display: block;
            width: 100%;
            text-align: left;
            padding: 10px 12px;
            background: transparent;
            border: none;
            color: #ccc;
            font-size: 0.9rem;
            border-radius: 6px;
            margin-bottom: 2px;
            cursor: pointer;
        }

        .sb-btn:hover {
            background: #222;
            color: #fff;
        }

        .sb-btn.active {
            background: #222;
            color: var(--accent);
            font-weight: 600;
        }

        /* MOBILE SIDEBAR BEHAVIOR */
        .sidebar-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 199;
        }

        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                top: 0;
                left: 0;
                height: 100%;
                z-index: 200;
                transform: translateX(-100%);
                transition: transform 0.2s;
                padding-top: var(--safe-top);
            }

            .sidebar.show {
                transform: translateX(0);
            }

            .sidebar-overlay.show {
                display: block;
            }

            .menu-btn {
                display: block;
            }
        }

        /* MAIN CONTENT */
        .main {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            background: var(--bg-color);
            padding-bottom: 80px;
        }

        /* CARDS (Restored Clean Style) */
        .card {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            border-bottom: 1px solid #222;
            padding-bottom: 8px;
        }

        .c-sym {
            font-weight: 700;
            font-size: 1.1rem;
            color: #fff;
        }

        .c-profit {
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--green);
            font-family: monospace;
        }

        .c-profit.neg {
            color: var(--red);
        }

        .c-row {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            margin-bottom: 5px;
            color: #aaa;
        }

        .c-val {
            color: #fff;
            font-family: monospace;
        }

        .c-b {
            font-weight: 600;
        }

        .c-hl {
            color: var(--accent);
        }

        /* TABLE (For All Coins) */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
        }

        .data-table th {
            text-align: left;
            padding: 8px;
            color: #666;
            border-bottom: 1px solid #333;
            font-weight: 600;
        }

        .data-table td {
            padding: 10px 8px;
            border-bottom: 1px solid #222;
            color: #ddd;
        }

        .col-right {
            text-align: right;
        }

        .t-sym {
            font-weight: 700;
            color: #fff;
        }

        .t-fund {
            font-family: monospace;
            font-size: 0.8rem;
        }

        .pos {
            color: var(--green);
        }

        .neg {
            color: var(--red);
        }

        /* BOTTOM NAV */
        .nav-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: calc(60px + var(--safe-bottom));
            background: #111;
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: space-around;
            align-items: flex-start;
            padding-top: 10px;
            z-index: 900;
        }

        .nav-item {
            background: none;
            border: none;
            color: #555;
            font-size: 0.7rem;
            font-weight: 600;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 0 10px;
        }

        .nav-item.active {
            color: var(--accent);
        }

        .nav-icon {
            font-size: 1.4rem;
        }

        /* TRY ARB SECTION */
        .try-group {
            background: #151515;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .try-head {
            font-weight: 700;
            color: #fff;
            margin-bottom: 10px;
            font-size: 0.9rem;
            border-bottom: 1px solid #2a2a2a;
            padding-bottom: 8px;
        }
    </style>
</head>

<body>
    <div class="sidebar-overlay" onclick="ui.toggleMenu(false)"></div>
    <div class="app-layout" style="height:100%">
        <!-- Header -->
        <header class="header">
            <div class="logo"><span>R</span>bit</div>
            <button class="menu-btn" id="menuBtn" onclick="ui.toggleMenu(true)">‚ò∞</button>
        </header>

        <div class="layout">
            <!-- Sidebar -->
            <aside class="sidebar" id="sidebar">
                <div id="sidebarContent"></div>
            </aside>

            <!-- Main View -->
            <main class="main" id="mainView"></main>
        </div>

        <!-- Bottom Nav -->
        <nav class="nav-bar">
            <button class="nav-item active" onclick="ui.nav('funding')"><span class="nav-icon">üìä</span>Funding</button>
            <button class="nav-item" onclick="ui.nav('try')"><span class="nav-icon">‚Ç∫</span>TRY Arb</button>
            <button class="nav-item" onclick="ui.nav('usdc')"><span class="nav-icon">üí≤</span>USDC</button>
            <button class="nav-item" onclick="ui.nav('settings')"><span class="nav-icon">‚öôÔ∏è</span>Settings</button>
        </nav>
    </div>

    <script>
        const PAIR_GROUPS = [
            { t: 'Market', i: [{ id: 'all-opps', l: 'All Opportunities' }, { id: 'all-coins', l: 'All Coins Table' }] },
            { t: 'Binance', i: [{ id: 'binance-okx', l: 'Binance / OKX' }, { id: 'binance-bybit', l: 'Binance / Bybit' }, { id: 'binance-hyperliquid', l: 'Binance / HL' }] },
            { t: 'OKX', i: [{ id: 'okx-bybit', l: 'OKX / Bybit' }, { id: 'okx-hyperliquid', l: 'OKX / HL' }] },
            { t: 'DeFi', i: [{ id: 'hyperliquid-asterdex', l: 'Hyperliquid / Aster' }] }
        ];

        const state = {
            tab: 'funding',
            filter: 'all-opps',
            data: {},
            allData: [],
            ws: null
        };

        const ui = {
            init: () => {
                ui.buildSidebar();
                ui.nav('funding');
                app.connect();
            },

            nav: (t) => {
                state.tab = t;
                document.querySelectorAll('.nav-item').forEach((b, i) => {
                    b.classList.toggle('active', ['funding', 'try', 'usdc', 'settings'][i] === t);
                });
                document.getElementById('menuBtn').style.display = (t === 'funding') ? 'block' : 'none';
                ui.render();
            },

            toggleMenu: (show) => {
                const sb = document.getElementById('sidebar');
                const ov = document.querySelector('.sidebar-overlay');
                if (show) { sb.classList.add('show'); ov.classList.add('show'); }
                else { sb.classList.remove('show'); ov.classList.remove('show'); }
            },

            buildSidebar: () => {
                let h = '';
                PAIR_GROUPS.forEach(g => {
                    h += `<div class="sb-section"><div class="sb-title">${g.t}</div>`;
                    g.i.forEach(it => {
                        h += `<button class="sb-btn" id="btn-${it.id}" onclick="ui.setFilter('${it.id}')">${it.l}</button>`;
                    });
                    h += `</div>`;
                });
                document.getElementById('sidebarContent').innerHTML = h;
            },

            setFilter: (f) => {
                state.filter = f;
                ui.toggleMenu(false);
                ui.render();
            },

            render: () => {
                const view = document.getElementById('mainView');
                if (state.tab !== 'funding') {
                    if (state.tab === 'try') ui.renderTRY(view);
                    else if (state.tab === 'usdc') view.innerHTML = '<div style="padding:20px; text-align:center;">Module Inactive</div>';
                    else if (state.tab === 'settings') view.innerHTML = '<div style="padding:20px; text-align:center;">Settings Placeholder</div>';
                    return;
                }

                // Update Sidebar Active
                document.querySelectorAll('.sb-btn').forEach(b => b.classList.remove('active'));
                const btn = document.getElementById('btn-' + state.filter);
                if (btn) btn.classList.add('active');

                // --- ALL COINS TABLE VIEW ---
                if (state.filter === 'all-coins') {
                    if (!state.allData || state.allData.length === 0) {
                        view.innerHTML = '<div style="padding:20px; text-align:center; color:#666;">Loading Market Data...</div>';
                        return;
                    }
                    let h = `<table class="data-table">
                    <thead><tr><th>Coin</th><th class="col-right">Binance</th><th class="col-right">OKX</th><th class="col-right">HL</th></tr></thead>
                    <tbody>`;
                    state.allData.sort((a, b) => a.symbol.localeCompare(b.symbol)).forEach(c => {
                        h += `<tr>
                        <td><div class="t-sym">${c.symbol}</div></td>
                        <td class="col-right t-fund ${parseFloat(c.binance?.funding) > 0 ? 'pos' : 'neg'}">${c.binance ? (parseFloat(c.binance.funding) * 100).toFixed(4) + '%' : '-'}</td>
                        <td class="col-right t-fund ${parseFloat(c.okx?.funding) > 0 ? 'pos' : 'neg'}">${c.okx ? (parseFloat(c.okx.funding) * 100).toFixed(4) + '%' : '-'}</td>
                        <td class="col-right t-fund ${parseFloat(c.hyperliquid?.funding) > 0 ? 'pos' : 'neg'}">${c.hyperliquid ? (parseFloat(c.hyperliquid.funding) * 100).toFixed(4) + '%' : '-'}</td>
                    </tr>`;
                    });
                    h += `</tbody></table>`;
                    view.innerHTML = h;
                    return;
                }

                // --- CARDS VIEW ---
                let list = [];
                if (state.filter === 'all-opps') {
                    Object.values(state.data).forEach(arr => { if (Array.isArray(arr)) list.push(...arr); });
                } else {
                    list = state.data[state.filter] || [];
                }
                list.sort((a, b) => b.profit - a.profit);

                if (list.length === 0) {
                    view.innerHTML = `<div style="padding:40px; text-align:center; color:#555;">No Opportunities Found<br><small>${state.filter}</small></div>`;
                    return;
                }

                view.innerHTML = list.map(d => {
                    const profit = d.profit || 0;
                    return `
                <div class="card">
                    <div class="card-header">
                        <span class="c-sym">${d.symbol}</span>
                        <span class="c-profit ${profit < 0 ? 'neg' : ''}">${profit.toFixed(4)}%</span>
                    </div>
                    <div class="c-row">
                        <span>LONG <b class="c-b">${d.longEx}</b></span>
                        <span class="c-val">${d.longPrice}</span>
                    </div>
                    <div class="c-row">
                        <span>SHORT <b class="c-b">${d.shortEx}</b></span>
                        <span class="c-val">${d.shortPrice}</span>
                    </div>
                    <div class="c-row" style="margin-top:8px; border-top:1px dashed #333; padding-top:5px;">
                        <span>APR: <span class="c-hl">${(d.analysis?.annualAPR || 0).toFixed(0)}%</span></span>
                        <span>Next: ${d.analysis?.durationHours || 8}h</span>
                    </div>
                </div>`;
                }).join('');
            },

            renderTRY: (view) => {
                // Simple TRY View
                const data = [
                    { n: 'Binance TR', p: 34.20 }, { n: 'Paribu', p: 34.28 }, { n: 'OKX TR', p: 34.18 }
                ];
                view.innerHTML = data.map(i => `
                <div class="try-group">
                    <div class="try-head">${i.n} USDT/TRY</div>
                    <div style="font-size:1.5rem; font-family:monospace; color:#fff;">${i.p.toFixed(2)} ‚Ç∫</div>
                </div>
            `).join('');
            }
        };

        const app = {
            connect: () => {
                const proto = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
                const ws = new WebSocket(`${proto}//${window.location.host}`);
                ws.onmessage = (e) => {
                    try {
                        const msg = JSON.parse(e.data);
                        if (msg.type === 'ARBITRAGE_UPDATE') {
                            state.data = msg.data;
                            if (msg.allData) state.allData = msg.allData;
                            if (state.tab === 'funding') ui.render();
                        }
                    } catch (e) { }
                };
                ws.onclose = () => setTimeout(app.connect, 2000);
            }
        };

        window.onload = ui.init;
    </script>
</body>

</html>