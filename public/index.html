<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Rbit | Premium Arbitrage</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;800;900&family=JetBrains+Mono:wght@400;500;700;800&display=swap"
        rel="stylesheet">

    <style>
        :root {
            --bg-body: #050505;
            --bg-card: #0F0F0F;
            --bg-card-hover: #141414;
            --bg-header: rgba(10, 10, 10, 0.95);
            --border-color: #222;
            --text-main: #EAEAEA;
            --text-dim: #888;
            --text-accent: #F7931A;
            --pos: #2ebd85;
            --neg: #f6465d;
            --font-main: 'Inter', sans-serif;
            --font-mono: 'JetBrains Mono', monospace;
            --binance: #FCD535;
            --okx: #fff;
            --bybit: #FFB119;
            --hl: #2D9CDB;
            --aster: #9B51E0;
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            margin: 0;
            background-color: var(--bg-body);
            color: var(--text-main);
            font-family: var(--font-main);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* SCROLLBAR */
        ::-webkit-scrollbar {
            width: 4px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #333;
            border-radius: 2px;
        }

        /* HERO HEADER */
        .header {
            height: 54px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 16px;
            background: var(--bg-header);
            border-bottom: 1px solid var(--border-color);
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        .logo {
            font-size: 1.2rem;
            font-weight: 900;
            letter-spacing: -0.5px;
            color: #fff;
        }

        .logo span {
            color: var(--text-accent);
        }

        .menu-btn {
            background: none;
            border: none;
            font-size: 1.4rem;
            color: #fff;
            display: none;
            cursor: pointer;
        }

        /* LAYOUT */
        .layout {
            display: flex;
            flex: 1;
            height: calc(100vh - 54px - 60px);
            position: relative;
        }

        /* - header - nav */
        .sidebar {
            width: 240px;
            background: #080808;
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            flex-shrink: 0;
        }

        .main {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
            padding-bottom: 40px;
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
        }

        /* MOBILE SIDEBAR */
        .overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(4px);
            z-index: 101;
        }

        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                inset: 0 auto 0 0;
                z-index: 102;
                transform: translateX(-100%);
                transition: transform 0.25s ease;
                border-right: 1px solid #333;
                width: 80%;
            }

            .sidebar.active {
                transform: translateX(0);
            }

            .overlay.active {
                display: block;
            }

            .menu-btn {
                display: block;
            }

            .main {
                padding: 12px;
            }

            .layout {
                height: calc(100vh - 54px);
            }

            /* Full height minus header */
        }

        /* SIDEBAR STYLES */
        .sb-sec {
            margin-bottom: 2px;
            border-bottom: 1px solid #141414;
        }

        .sb-head {
            padding: 14px 16px 8px;
            font-size: 0.65rem;
            font-weight: 800;
            color: #555;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .sb-btn {
            width: 100%;
            text-align: left;
            background: transparent;
            border: none;
            padding: 10px 16px;
            color: #999;
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            transition: 0.1s;
            border-left: 2px solid transparent;
        }

        .sb-btn:hover {
            color: #fff;
            background: rgba(255, 255, 255, 0.02);
        }

        .sb-btn.active {
            background: linear-gradient(90deg, rgba(247, 147, 26, 0.08) 0%, transparent 100%);
            color: var(--text-accent);
            border-left-color: var(--text-accent);
            font-weight: 700;
        }

        /* --- PREMIUM CARD DESIGN --- */
        .master-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            margin-bottom: 20px;
            overflow: hidden;
            position: relative;
        }

        .mc-header {
            padding: 14px 16px;
            border-bottom: 1px solid var(--border-color);
            background: linear-gradient(180deg, rgba(30, 30, 30, 0.4) 0%, transparent 100%);
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .mc-title {
            font-size: 1.1rem;
            font-weight: 800;
            color: #fff;
            margin-bottom: 2px;
        }

        .mc-sub {
            font-size: 0.75rem;
            color: #888;
            font-family: var(--font-mono);
        }

        .mc-apr {
            font-size: 1.2rem;
            font-weight: 900;
            color: var(--text-accent);
            text-align: right;
            text-shadow: 0 0 10px rgba(247, 147, 26, 0.15);
        }

        .mc-apr-lbl {
            font-size: 0.65rem;
            color: #555;
            font-weight: 700;
            text-transform: uppercase;
            text-align: right;
        }

        .mc-sides {
            display: grid;
            grid-template-columns: 1fr 1fr;
            border-bottom: 1px solid var(--border-color);
        }

        .mc-side {
            padding: 14px;
            position: relative;
        }

        .mc-side:first-child {
            border-right: 1px solid var(--border-color);
            background: linear-gradient(90deg, rgba(46, 189, 133, 0.03) 0%, transparent 100%);
        }

        .mc-side:last-child {
            background: linear-gradient(-90deg, rgba(246, 70, 93, 0.03) 0%, transparent 100%);
        }

        .mc-lbl {
            font-size: 0.65rem;
            font-weight: 800;
            text-transform: uppercase;
            margin-bottom: 6px;
            display: block;
        }

        .long {
            color: var(--pos);
        }

        .short {
            color: var(--neg);
        }

        .mc-ex {
            font-weight: 700;
            font-size: 0.95rem;
            color: #ddd;
            margin-bottom: 2px;
        }

        .mc-price {
            font-family: var(--font-mono);
            font-size: 0.85rem;
            color: #888;
        }

        .mc-grid {
            margin-top: 10px;
            display: grid;
            grid-template-columns: 1fr;
            gap: 4px;
        }

        .mc-row {
            display: flex;
            justify-content: space-between;
            font-size: 0.7rem;
            color: #555;
        }

        .mc-val {
            font-family: var(--font-mono);
            color: #ccc;
            font-weight: 600;
        }

        .pos {
            color: var(--pos);
        }

        .neg {
            color: var(--neg);
        }

        .mc-breakdown {
            padding: 14px;
            background: #080808;
            border-top: 1px solid #1a1a1a;
        }

        .mcb-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 6px;
            font-size: 0.8rem;
        }

        .mcb-lbl {
            color: #666;
        }

        .mcb-val {
            font-family: var(--font-mono);
            color: #ccc;
        }

        .mcb-total {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px dashed #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .mcb-tot-lbl {
            font-weight: 800;
            font-size: 0.85rem;
            color: #fff;
        }

        .mcb-tot-val {
            font-family: var(--font-mono);
            font-weight: 800;
            font-size: 1.1rem;
            color: var(--pos);
        }

        /* ALL DATA TABLE */
        .table-wrap {
            overflow-x: auto;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: var(--bg-card);
        }

        .ctable {
            width: 100%;
            border-collapse: collapse;
            min-width: 600px;
        }

        .ctable th {
            text-align: right;
            padding: 12px;
            background: #111;
            color: #666;
            font-size: 0.7rem;
            font-weight: 800;
            border-bottom: 1px solid #222;
        }

        .ctable th:first-child {
            text-align: left;
        }

        .ctable td {
            padding: 10px 12px;
            border-bottom: 1px solid #1a1a1a;
            text-align: right;
            vertical-align: middle;
        }

        .ct-cell {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 2px;
        }

        .ct-f {
            font-family: var(--font-mono);
            font-weight: 700;
            font-size: 0.8rem;
            color: #ddd;
        }

        .ct-p {
            font-family: var(--font-mono);
            font-size: 0.7rem;
            color: #555;
        }

        /* OPP LIST ROW */
        .opp-row {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 8px;
            display: grid;
            grid-template-columns: 1fr 1fr 1fr auto;
            gap: 8px;
            align-items: center;
        }

        .opp-sym {
            font-weight: 800;
            font-size: 0.9rem;
            color: #fff;
        }

        .opp-inf {
            display: flex;
            flex-direction: column;
            font-size: 0.7rem;
        }

        .opp-inf span {
            font-family: var(--font-mono);
            color: #888;
        }

        .opp-apr {
            font-weight: 800;
            color: var(--text-accent);
            font-size: 0.95rem;
            text-align: right;
        }

        /* BOTTOM NAV */
        .nav {
            position: fixed;
            bottom: 0;
            width: 100%;
            height: 60px;
            background: var(--bg-header);
            backdrop-filter: blur(10px);
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: space-around;
            align-items: center;
            z-index: 99;
            padding-bottom: env(safe-area-inset-bottom);
        }

        .nav-item {
            background: none;
            border: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            font-size: 0.65rem;
            font-weight: 600;
            color: #555;
            opacity: 0.8;
            transition: 0.2s;
        }

        .nav-item.active {
            color: var(--text-accent);
            opacity: 1;
            transform: translateY(-2px);
        }

        .nav-icon {
            font-size: 1.2rem;
        }

        .try-card {
            background: #111;
            border: 1px solid #222;
            border-radius: 12px;
            margin-bottom: 12px;
            overflow: hidden;
        }

        .tc-h {
            padding: 10px 14px;
            background: #161616;
            display: flex;
            justify-content: space-between;
            border-bottom: 1px solid #222;
        }

        .tc-t {
            font-weight: 700;
            font-size: 0.9rem;
        }

        .tc-p {
            font-family: var(--font-mono);
            color: var(--text-accent);
            font-weight: 700;
        }

        .tc-d {
            padding: 10px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .tr {
            display: flex;
            justify-content: space-between;
            font-family: var(--font-mono);
            font-size: 0.7rem;
            padding: 2px 4px;
            border-radius: 2px;
            margin-bottom: 2px;
        }

        .tb {
            background: rgba(46, 189, 133, 0.1);
            color: var(--pos);
        }

        .ta {
            background: rgba(246, 70, 93, 0.1);
            color: var(--neg);
        }
    </style>
</head>

<body>
    <div class="header">
        <div class="logo">R<span>bit</span></div>
        <button class="menu-btn" id="menuBtn" onclick="ui.toggle(true)">‚ò∞</button>
    </div>

    <div class="overlay" onclick="ui.toggle(false)"></div>
    <div class="layout">
        <aside class="sidebar" id="sidebar">
            <div id="sbContent"></div>
        </aside>
        <main class="main" id="mainView"></main>
    </div>

    <nav class="nav">
        <button class="nav-item active" onclick="ui.nav('funding')"><span class="nav-icon">üìä</span>Funding</button>
        <button class="nav-item" onclick="ui.nav('try')"><span class="nav-icon">‚Ç∫</span>TRY Arb</button>
        <button class="nav-item" onclick="ui.nav('usdc')"><span class="nav-icon">üí≤</span>USDC</button>
        <button class="nav-item" onclick="ui.nav('settings')"><span class="nav-icon">‚öôÔ∏è</span>Settings</button>
    </nav>

    <script>
        const PAIR_GROUPS = [
            { t: 'Overview', i: [{ id: 'all-opps', l: 'All Opportunities' }, { id: 'all-coins', l: 'All Data (Table)' }] },
            { t: 'Binance Pairs', i: [{ id: 'binance-okx', l: 'Binance <> OKX' }, { id: 'binance-bybit', l: 'Binance <> Bybit' }, { id: 'binance-hyperliquid', l: 'Binance <> HL' }, { id: 'binance-asterdex', l: 'Binance <> Aster' }] },
            { t: 'OKX Pairs', i: [{ id: 'okx-bybit', l: 'OKX <> Bybit' }, { id: 'okx-hyperliquid', l: 'OKX <> HL' }, { id: 'okx-asterdex', l: 'OKX <> Aster' }] },
            { t: 'Bybit Pairs', i: [{ id: 'bybit-hyperliquid', l: 'Bybit <> HL' }, { id: 'bybit-asterdex', l: 'Bybit <> Aster' }] },
            { t: 'Hyperliquid Pairs', i: [{ id: 'hyperliquid-asterdex', l: 'HL <> Aster' }] }
        ];

        const state = { tab: 'funding', filter: 'all-opps', data: {}, allData: [] };

        const ui = {
            init: () => {
                ui.buildSidebar();
                ui.nav('funding');
                app.connect();
                setInterval(ui.updateTryData, 2000);
            },

            nav: (t) => {
                state.tab = t;
                const btn = document.getElementById('menuBtn');
                if (t === 'funding') btn.style.display = 'block';
                else { btn.style.display = 'none'; ui.toggle(false); }

                document.querySelectorAll('.nav-item').forEach((b, i) => b.classList.toggle('active', ['funding', 'try', 'usdc', 'settings'][i] === t));
                ui.render();
            },

            toggle: (s) => {
                const sb = document.getElementById('sidebar');
                const ov = document.querySelector('.overlay');
                if (s) { sb.classList.add('active'); ov.classList.add('active'); }
                else { sb.classList.remove('active'); ov.classList.remove('active'); }
            },

            buildSidebar: () => {
                let h = '';
                PAIR_GROUPS.forEach(g => {
                    h += `<div class="sb-sec"><div class="sb-head">${g.t}</div>`;
                    g.i.forEach(it => {
                        h += `<button class="sb-btn" id="btn-${it.id}" onclick="ui.setFilter('${it.id}')">${it.l}</button>`;
                    });
                    h += `</div>`;
                });
                document.getElementById('sbContent').innerHTML = h;
            },

            setFilter: (f) => {
                state.filter = f;
                ui.toggle(false);
                ui.render();
            },

            render: () => {
                const v = document.getElementById('mainView');
                if (state.tab !== 'funding') {
                    if (state.tab === 'try') ui.renderTRY(v);
                    else v.innerHTML = `<div style="padding:40px;text-align:center;color:#444;">Module ${state.tab}</div>`;
                    return;
                }

                document.querySelectorAll('.sb-btn').forEach(b => b.classList.remove('active'));
                const b = document.getElementById('btn-' + state.filter);
                if (b) b.classList.add('active');

                if (state.filter === 'all-coins') return ui.renderAllCoins(v);
                if (state.filter === 'all-opps') return ui.renderAllOpps(v);
                ui.renderDetailed(v);
            },

            formatTime: (ms) => {
                if (!ms) return '8h 00m';
                const diff = ms - Date.now();
                if (diff <= 0) return 'Funding...';
                const h = Math.floor(diff / 3600000);
                const m = Math.floor((diff % 3600000) / 60000);
                return `${h}h ${m}m`;
            },

            renderAllCoins: (v) => {
                if (!state.allData.length) { v.innerHTML = '<div style="padding:20px;text-align:center;color:#666;">Loading Data...</div>'; return; }
                const sorted = [...state.allData].sort((a, b) => a.symbol.localeCompare(b.symbol));

                const cell = (ex) => {
                    if (!ex || !ex.price) return `<div class="ct-cell"><span class="ct-p">-</span></div>`;
                    const f = Number(ex.funding || 0);
                    // Backend already sends funding rate as percentage (e.g., 0.01 = 0.01%)
                    const fs = isNaN(f) ? '0.00%' : f.toFixed(4) + '%';
                    const cls = f > 0 ? 'pos' : (f < 0 ? 'neg' : '');

                    return `<div class="ct-cell">
                    <span class="ct-f ${cls}">${fs}</span>
                    <span class="ct-p">${Number(ex.price).toFixed(4)}</span>
                </div>`;
                };

                let h = `<div class="table-wrap"><table class="ctable">
            <thead><tr>
                <th>Coin</th>
                <th style="color:var(--binance)">Binance</th>
                <th style="color:var(--okx)">OKX</th>
                <th style="color:var(--bybit)">Bybit</th>
                <th style="color:var(--hl)">Hyper</th>
                <th style="color:var(--aster)">Aster</th>
            </tr></thead><tbody>`;
                sorted.forEach(c => {
                    h += `<tr>
                    <td>${c.symbol}</td>
                    <td>${cell(c.binance)}</td>
                    <td>${cell(c.okx)}</td>
                    <td>${cell(c.bybit)}</td>
                    <td>${cell(c.hyperliquid)}</td>
                    <td>${cell(c.asterdex)}</td>
                </tr>`;
                });
                h += `</tbody></table></div>`;
                v.innerHTML = h;
            },

            renderAllOpps: (v) => {
                let list = [];
                Object.values(state.data).forEach(a => { if (Array.isArray(a)) list.push(...a); });
                if (!list.length) { v.innerHTML = '<div style="padding:20px;text-align:center;color:#666;">Scanning...</div>'; return; }

                list.sort((a, b) => (b.analysis?.annualAPR || 0) - (a.analysis?.annualAPR || 0));
                list = list.slice(0, 50);

                let h = '<div style="font-size:0.7rem; font-weight:800; color:#444; margin-bottom:10px; padding-left:4px; text-transform:uppercase;">Top Opportunities</div>';
                list.forEach(d => {
                    const an = d.analysis || {};
                    let L = d.exchangeA, S = d.exchangeB;
                    if (an.strategy === 'SHORT_A_LONG_B') { L = d.exchangeB; S = d.exchangeA; }

                    const isA_Long = an.strategy === 'LONG_A_SHORT_B';
                    L = isA_Long ? d.exchangeA : d.exchangeB;
                    S = isA_Long ? d.exchangeB : d.exchangeA;

                    // Backend already sends funding rate as percentage
                    const lf = Number(L.fundingRate || 0), sf = Number(S.fundingRate || 0);

                    h += `<div class="opp-row">
                    <div class="opp-sym">${d.symbol}</div>
                    <div class="opp-inf">
                        <span style="color:var(--pos); font-weight:700;">L: ${L.name}</span>
                        <span>${Number(L.markPrice).toFixed(4)}</span>
                        <span class="${lf > 0 ? 'pos' : 'neg'}">${lf.toFixed(4)}%</span>
                    </div>
                    <div class="opp-inf">
                        <span style="color:var(--neg); font-weight:700;">S: ${S.name}</span>
                        <span>${Number(S.markPrice).toFixed(4)}</span>
                        <span class="${sf > 0 ? 'pos' : 'neg'}">${sf.toFixed(4)}%</span>
                    </div>
                    <div class="opp-apr">${(an.annualAPR || 0).toFixed(0)}%</div>
                </div>`;
                });
                v.innerHTML = h;
            },

            renderDetailed: (v) => {
                const list = (state.data[state.filter] || []).sort((a, b) => (b.analysis?.annualAPR || 0) - (a.analysis?.annualAPR || 0)).slice(0, 10);
                if (!list.length) { v.innerHTML = `<div style="padding:40px; text-align:center; opacity:0.5;">Waiting for data...</div>`; return; }

                v.innerHTML = list.map(d => {
                    const an = d.analysis || {};
                    const isA_Long = an.strategy === 'LONG_A_SHORT_B';
                    const L = isA_Long ? d.exchangeA : d.exchangeB;
                    const S = isA_Long ? d.exchangeB : d.exchangeA;

                    const makerFee = (an.tradeSize || 100) * 0.0002;
                    const takerFee = (an.tradeSize || 100) * 0.0005;
                    const netProfit = an.netCycleProfit || 0;

                    // Backend already sends funding rate as percentage
                    const lf = Number(L.fundingRate || 0);
                    const sf = Number(S.fundingRate || 0);

                    return `<div class="master-card">
                    <div class="mc-header">
                        <div>
                            <div class="mc-title">${d.symbol}</div>
                            <div class="mc-sub">Next Profit: <span class="pos">$${netProfit.toFixed(4)}</span></div>
                        </div>
                        <div>
                            <div class="mc-apr">${(an.annualAPR || 0).toFixed(0)}%</div>
                            <div class="mc-apr-lbl">Annual APR</div>
                        </div>
                    </div>
                    
                    <div class="mc-sides">
                        <div class="mc-side">
                            <span class="mc-lbl long">Long Buy</span>
                            <div class="mc-ex">${L.name}</div>
                            <div class="mc-price">$${Number(L.markPrice).toFixed(4)}</div>
                            <div class="mc-grid">
                                <div class="mc-row"><span>Funding</span><span class="mc-val ${lf > 0 ? 'pos' : 'neg'}">${lf.toFixed(4)}%</span></div>
                                <div class="mc-row"><span>Interval</span><span class="mc-val">${ui.formatTime(L.nextFundingTime)}</span></div>
                            </div>
                        </div>
                        <div class="mc-side">
                            <span class="mc-lbl short">Short Sell</span>
                            <div class="mc-ex">${S.name}</div>
                            <div class="mc-price">$${Number(S.markPrice).toFixed(4)}</div>
                             <div class="mc-grid">
                                <div class="mc-row"><span>Funding</span><span class="mc-val ${sf > 0 ? 'pos' : 'neg'}">${sf.toFixed(4)}%</span></div>
                                <div class="mc-row"><span>Interval</span><span class="mc-val">${ui.formatTime(S.nextFundingTime)}</span></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mc-breakdown">
                        <div class="mcb-row"><span class="mcb-lbl">Est. Maker Fee</span><span class="mcb-val neg">-$${makerFee.toFixed(3)}</span></div>
                        <div class="mcb-row"><span class="mcb-lbl">Est. Taker Fee</span><span class="mcb-val neg">-$${takerFee.toFixed(3)}</span></div>
                        <div class="mcb-row"><span class="mcb-lbl">Price Diff PnL</span><span class="mcb-val ${(an.priceDiffPnL || 0) > 0 ? 'pos' : 'neg'}">$${(an.priceDiffPnL || 0).toFixed(3)}</span></div>
                        <div class="mcb-row"><span class="mcb-lbl">Funding Income</span><span class="mcb-val pos">+$${(an.fundingIncomeCycle || 0).toFixed(3)}</span></div>
                        
                        <div class="mcb-total">
                            <span class="mcb-tot-lbl">Net Cycle Profit</span>
                            <span class="mcb-tot-val ${netProfit > 0 ? 'pos' : 'neg'}">$${netProfit.toFixed(4)}</span>
                        </div>
                    </div>
                </div>`;
                }).join('');
            },

            renderTRY: (v) => {
                const pairs = [{ n: 'Binance TR', p: 35.84 }, { n: 'Paribu', p: 35.92 }, { n: 'OKX TR', p: 35.82 }, { n: 'Bybit TR', p: 35.80 }];
                let h = `<div style="padding:10px 4px; font-weight:800; color:#555; font-size:0.7rem;">USDT/TRY LIVE</div>`;
                h += pairs.map(p => {
                    const ask = p.p + Math.random() * 0.04;
                    const bid = p.p - Math.random() * 0.04;
                    return `<div class="try-card">
                    <div class="tc-h"><span class="tc-t">${p.n}</span><span class="tc-p">${p.p.toFixed(2)} ‚Ç∫</span></div>
                    <div class="tc-d">
                        <div class="tc-c"><div class="tr bid"><span>${(bid - 0.01).toFixed(2)}</span><span>12K</span></div><div class="tr bid"><span>${(bid - 0.05).toFixed(2)}</span><span>8K</span></div></div>
                        <div class="tc-c"><div class="tr ask"><span>${(ask + 0.01).toFixed(2)}</span><span>2K</span></div><div class="tr ask"><span>${(ask + 0.05).toFixed(2)}</span><span>5K</span></div></div>
                    </div>
                </div>`;
                }).join('');
                v.innerHTML = h;
            },

            updateTryData: () => { if (state.tab === 'try') ui.renderTRY(document.getElementById('mainView')); }
        };

        const app = {
            connect: () => {
                const ws = new WebSocket((location.protocol === 'https:' ? 'wss:' : 'ws:') + '//' + location.host);
                ws.onmessage = e => {
                    try {
                        const m = JSON.parse(e.data);
                        if (m.type === 'ARBITRAGE_UPDATE') { state.data = m.data; if (m.allData) state.allData = m.allData; if (state.tab === 'funding') ui.render(); }
                    } catch (e) { }
                };
                ws.onclose = () => setTimeout(app.connect, 2000);
            }
        };
        window.onload = ui.init;
    </script>
</body>

</html>